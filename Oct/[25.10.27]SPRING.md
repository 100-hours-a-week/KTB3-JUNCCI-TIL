# 📚 SPRING 핵심 개념 정리(ORM, JPA, DTO, ENTITY)

---
ORM (Object-Relational Mapping) → 객체와 데이터베이스 테이블을 자동으로 매핑해주는 기술.
➜ “객체로 DB를 다루게 해주는 다리”

JPA (Java Persistence API) → 자바 진영의 ORM 표준 인터페이스.
➜ “ORM을 쓰기 위한 규칙서 (대표 구현체: Hibernate)”

Entity → 데이터베이스의 테이블과 1:1로 매핑되는 클래스.
➜ “DB 레코드 한 줄을 표현하는 객체”

DTO (Data Transfer Object) → 계층 간 데이터 전달용 객체.
➜ “엔티티를 그대로 노출하지 않고, 필요한 데이터만 담는 전송용 상자”

<img width="900" alt="JPA Sequence Diagram" src="https://github.com/user-attachments/assets/6dce6c8b-b467-42df-ae25-31fd27f725fc" />

<img width="900" alt="Mermaid JPA Diagram" src="https://github.com/user-attachments/assets/cf4e7b56-67f6-46e0-b758-97dff05a7278" />

## 🧱 전체 구조 요약

```
com.example.jpademo
├── domain/           ← 엔티티 (JPA 관리)
│    ├── Member.java
│    └── Team.java
│
├── repository/       ← 데이터 접근 (DAO, Repository)
│    ├── MemberRepository.java
│    └── TeamRepository.java
│
├── service/          ← 비즈니스 로직 (Service Layer)
│    └── MemberService.java
│
├── dto/              ← DTO (Data Transfer Object)
│    └── MemberDto.java
│
├── DemoRunner.java   ← 테스트용 실행 클래스
└── JpaDemoApplication.java  ← 메인 부트스트랩 (Spring Boot 시작점)
```

---

## 1️⃣ Entity (도메인 계층)

### 📁 `domain/Member.java`

```java
@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;
    private String name;
    private int age;

    @ManyToOne(fetch = FetchType.LAZY)
    private Team team;

    // getters/setters
}
```

### `domain/Team.java`

```java
@Entity
public class Team {
    @Id @GeneratedValue
    private Long id;
    private String name;

    // getters/setters
}
```

#### 💡 역할

* **JPA가 직접 관리하는 객체 (테이블 매핑 대상)**
* `@Entity` 붙은 클래스는 DB 테이블과 1:1 대응
* 필드 ↔ 컬럼 자동 매핑
* `@ManyToOne`, `@OneToMany` 같은 관계 설정으로 ORM 구현

#### 여기서 배우는 JPA 핵심

* **객체 중심 개발**: SQL 중심이 아닌, 엔티티 중심으로 비즈니스 로직 작성
* **영속성 컨텍스트**를 통해 변경 감지, 1차 캐시, 지연 로딩 등 활용 가능

---

## 2️⃣ Repository (데이터 접근 계층)

### `repository/MemberRepository.java`

```java
public interface MemberRepository extends JpaRepository<Member, Long> {
    List<Member> findByName(String name);
}
```

### `repository/TeamRepository.java`

```java
public interface TeamRepository extends JpaRepository<Team, Long> {}
```

#### 💡 역할

* **데이터 접근(DAO)** 을 대신하는 스프링 데이터 JPA 레이어
* `JpaRepository`를 상속하면 `save`, `findAll`, `findById`, `delete` 등이 자동 제공
* **메서드 이름으로 쿼리 자동 생성** (e.g. `findByName`)

#### 여기서 배우는 JPA 핵심

* SQL을 직접 작성하지 않고 **메서드 네이밍 규칙으로 쿼리 생성**
* Spring Data JPA가 **프록시 구현체를 자동 생성**

---

## 3️⃣ Service (비즈니스 계층)

### `service/MemberService.java`

```java
@Service
@Transactional(readOnly = true)
public class MemberService {
    private final MemberRepository memberRepository;

    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    public MemberDto getMemberDto(Long id) {
        Member member = memberRepository.findById(id).orElseThrow();
        return new MemberDto(member.getName(), member.getTeam().getName());
    }
}
```

#### 💡 역할

* **트랜잭션 단위의 비즈니스 로직 수행**
* 여러 Repository를 조합하거나, 도메인 로직을 관리
* `@Transactional` 로 트랜잭션 범위 지정 (자동 커밋/롤백)

#### 여기서 배우는 JPA 핵심

* JPA는 트랜잭션 범위 안에서만 **엔티티를 영속성 컨텍스트에 관리**
* 서비스 계층이 **트랜잭션 경계 (Boundary)** 역할을 함

---

## 4️⃣ DTO (데이터 전달 객체)

### `dto/MemberDto.java`

```java
public class MemberDto {
    private String name;
    private String teamName;

    public MemberDto(String name, String teamName) {
        this.name = name;
        this.teamName = teamName;
    }

    // getters
}
```

#### 💡 역할

* **Entity → 외부로 전달 시 사용하는 데이터 전용 클래스**
* 엔티티를 그대로 노출하지 않고, 필요한 데이터만 전달

#### 여기서 배우는 핵심

* **Entity는 내부 로직 중심**, **DTO는 표현(View/API) 중심**
* Controller, REST API 응답, 또는 서비스 반환값 등에 DTO 사용

---

## 5️⃣ DemoRunner (실행 테스트)

```java
@Component
@Transactional
public class DemoRunner implements CommandLineRunner {

    private final MemberRepository memberRepository;
    private final TeamRepository teamRepository;
    private final MemberService memberService;

    public void run(String... args) {
        Team team = new Team();
        team.setName("Team A");
        teamRepository.save(team);

        Member member = new Member();
        member.setName("홍길동");
        member.setAge(25);
        member.setTeam(team);
        memberRepository.save(member);

        var dto = memberService.getMemberDto(member.getId());
        System.out.println("DTO 이름: " + dto.getName());
        System.out.println("DTO 소속팀: " + dto.getTeamName());
    }
}
```

#### 💡 역할

* **Spring Boot 실행 시 자동 실행되는 테스트용 Runner**
* 애플리케이션이 실제로 JPA를 통해 동작하는지 검증

#### 실행 흐름

1️⃣ `JpaDemoApplication` → Spring Boot 실행
2️⃣ `DemoRunner` 자동 실행
3️⃣ `Team`, `Member` 저장 → JPA가 SQL 생성 후 실행
4️⃣ 조회 후 DTO로 반환

---

## 🧠 6️⃣ ORM, JPA, Entity, DTO의 관계 요약

| 개념                                  | 설명                                    | 코드 예시                            |
| ----------------------------------- | ------------------------------------- | -------------------------------- |
| **ORM (Object Relational Mapping)** | 객체를 관계형 DB 테이블과 자동 매핑                 | `@Entity`, `@ManyToOne`          |
| **JPA (Java Persistence API)**      | ORM을 위한 **표준 인터페이스** (Hibernate가 구현체) | `JpaRepository`, `EntityManager` |
| **Entity**                          | JPA가 관리하는 도메인 객체                      | `Member`, `Team`                 |
| **DTO**                             | 계층 간 데이터 전달용 객체                       | `MemberDto`                      |
| **Repository**                      | DB 접근 담당, JPA 기반 쿼리 생성                | `MemberRepository`               |
| **Service**                         | 트랜잭션/비즈니스 로직 수행                       | `MemberService`                  |

---


