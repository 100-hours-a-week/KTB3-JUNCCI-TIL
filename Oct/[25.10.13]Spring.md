# ðŸ“Œ Spring í•µì‹¬ ê°œë… ì •ë¦¬ - Bean Lifecycle, Bean Scope ì •ë¦¬
# Spring Bean Lifecycle
---

## ê°œë…

**Bean Lifecycle**ì´ëž€,

> Spring IoC ì»¨í…Œì´ë„ˆê°€ **Beanì„ ìƒì„± â†’ ì˜ì¡´ì„± ì£¼ìž… â†’ ì´ˆê¸°í™” â†’ ì‚¬ìš© â†’ ì†Œë©¸** ì‹œí‚¤ëŠ” ì „ ê³¼ì •ì„ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°ìž…ë‹ˆë‹¤.
> 

Springì´ Beanì˜ ìƒëª…ì£¼ê¸°ë¥¼ ì œì–´í•¨ìœ¼ë¡œì¨

ê°ì²´ ìƒì„± ì‹œì , ì˜ì¡´ì„± ì—°ê²° ì‹œì , ìžì› í•´ì œ ì‹œì ì„ ì¼ê´€ë˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

---

## ë‹¨ê³„ë³„ ì„¤ëª…

| ë‹¨ê³„ | ë™ìž‘ | ì£¼ìš” ë©”ì„œë“œ / ì–´ë…¸í…Œì´ì…˜ | ì„¤ëª… |
| --- | --- | --- | --- |
| **1. ì¸ìŠ¤í„´ìŠ¤í™” (Instantiation)** | Bean ê°ì²´ ìƒì„± | ìƒì„±ìž | Springì´ Beanì„ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¼ (`new` í˜¸ì¶œ) |
| **2. ì˜ì¡´ì„± ì£¼ìž… (Dependency Injection)** | í•„ìš”í•œ Bean, ê°’ ì£¼ìž… | `@Autowired`, `@Value`, `@Resource` | ë‹¤ë¥¸ Beanì´ë‚˜ ì„¤ì •ê°’ì„ ì£¼ìž… |
| **3. Aware ì½œë°± (Aware Callback)** | ì»¨í…Œì´ë„ˆ ì •ë³´ ì ‘ê·¼ | `BeanNameAware`, `ApplicationContextAware` ë“± | Beanì´ ìžì‹ ì˜ ì´ë¦„, Context ì •ë³´ ë“±ì„ ë°›ì„ ìˆ˜ ìžˆìŒ |
| **4. ì „ì²˜ë¦¬ (Pre-processing)** | ì´ˆê¸°í™” ì „ Bean ê°€ê³µ | `BeanPostProcessor.postProcessBeforeInitialization()` | í”„ë¡ì‹œ ìƒì„±, AOP ì„¤ì • ë“± ì´ˆê¸°í™” ì „ ìž‘ì—… |
| **5. ì´ˆê¸°í™” (Initialization)** | Bean ì‚¬ìš© ì¤€ë¹„ ë‹¨ê³„ | `@PostConstruct`, `InitializingBean.afterPropertiesSet()`, `init-method` | Beanì´ ì™„ì „ížˆ ì£¼ìž…ëœ í›„ ì‹¤í–‰ë˜ëŠ” ì´ˆê¸° ì¤€ë¹„ ë¡œì§ |
| **6. í›„ì²˜ë¦¬ (Post-processing)** | ì´ˆê¸°í™” í›„ Bean ê°€ê³µ | `BeanPostProcessor.postProcessAfterInitialization()` | Beanì„ Proxyë¡œ ê°ì‹¸ê±°ë‚˜ ì¶”ê°€ ì„¤ì • ì ìš© |
| **7. ì‚¬ìš© (Use)** | ì„œë¹„ìŠ¤ ë¡œì§ ìˆ˜í–‰ | â€” | Controller, Service ë“±ì—ì„œ Beanì´ ì‚¬ìš©ë˜ëŠ” ì‹œì  |
| **8. ì†Œë©¸ (Destruction)** | ìžì› ì •ë¦¬ ë° ì¢…ë£Œ | `@PreDestroy`, `DisposableBean.destroy()`, `destroy-method` | ì»¨í…Œì´ë„ˆ ì¢…ë£Œ ì‹œ Beanì´ ì‚¬ìš©í•œ ìžì› í•´ì œ |

---

## 3ï¸âƒ£ `@PostConstruct` ì™€ `@PreDestroy` ì–´ë…¸í…Œì´ì…˜

ì´ ë‘ ì–´ë…¸í…Œì´ì…˜ì€ **Beanì˜ ì´ˆê¸°í™”ì™€ ì†Œë©¸ ì‹œì ì— ìžë™ìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” ë©”ì„œë“œ**ë¥¼ ì§€ì •í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

â†’ **ì§ì ‘ ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì§€ ì•Šê³ ë„** ê°„ë‹¨ížˆ ì´ˆê¸°í™”Â·ì •ë¦¬ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### `@PostConstruct`

- **ì˜ë¯¸**: Bean ìƒì„± ë° ì˜ì¡´ì„± ì£¼ìž…ì´ ì™„ë£Œëœ ì§í›„ í˜¸ì¶œ.
- **ì‚¬ìš© ëª©ì **: Beanì´ ì™„ì „ížˆ ì¤€ë¹„ëœ í›„ ì‹¤í–‰í•  ì´ˆê¸°í™” ë¡œì§ì„ ë„£ìŒ.
- **ì˜ˆì‹œ ì—­í• **
    - DB ì—°ê²° í’€ ì¤€ë¹„
    - ì´ˆê¸° ìºì‹œ ë¡œë”©
    - ì„¤ì • íŒŒì¼ ê²€ì¦
    - ë¡œê·¸ ì´ˆê¸°í™” ë“±

**í˜¸ì¶œ ì‹œì **

`BeanPostProcessor.postProcessBeforeInitialization()` ì´í›„,

`InitializingBean.afterPropertiesSet()` ì´ì „.

---

### `@PreDestroy`

- **ì˜ë¯¸**: ì»¨í…Œì´ë„ˆ ì¢…ë£Œ ì „ì— Beanì´ ì†Œë©¸ë˜ê¸° ì§ì „ í˜¸ì¶œ.
- **ì‚¬ìš© ëª©ì **: Beanì´ ì‚¬ìš©í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì•ˆì „í•˜ê²Œ í•´ì œí•˜ê±°ë‚˜ ì €ìž¥.
- **ì˜ˆì‹œ ì—­í• **
    - DB ì»¤ë„¥ì…˜ ì¢…ë£Œ
    - ThreadPool, KafkaProducer, Redis ì—°ê²° í•´ì œ
    - íŒŒì¼ í•¸ë“¤ ë‹«ê¸°
    - ë¡œê·¸ ë§ˆë¬´ë¦¬ ì²˜ë¦¬ ë“±

**í˜¸ì¶œ ì‹œì **

`context.close()` ë˜ëŠ” Springì´ ì¢…ë£Œ ì‹ í˜¸ë¥¼ ë°›ì„ ë•Œ ì‹¤í–‰ë¨.

ì´í›„ `DisposableBean.destroy()`ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.

---

## 4ï¸âƒ£ Bean Lifecycleì„ ì•Œì•„ì•¼ í•˜ëŠ” ì´ìœ 

| ì´ìœ  | ì„¤ëª… |
| --- | --- |
| **1. ì•ˆì •ì ì¸ ì´ˆê¸°í™”/ì†Œë©¸ ì²˜ë¦¬** | Beanì˜ ìƒì„± ë° ì¢…ë£Œ ì‹œì ì— ìžì›ì„ ì •í™•ížˆ ê´€ë¦¬í•  ìˆ˜ ìžˆìŒ |
| **2. ì‹œì  ë¬¸ì œ í•´ê²°** | `@Autowired` null ë¬¸ì œ, Proxy ê´€ë ¨ ì˜¤ë¥˜ ë“±ì„ ì´í•´í•˜ê³  í•´ê²° ê°€ëŠ¥ |
| **3. í”„ë ˆìž„ì›Œí¬ í™•ìž¥ ê°€ëŠ¥** | BeanPostProcessor, ApplicationListener ë“± êµ¬í˜„ ê°€ëŠ¥ |
| **4. ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ íš¨ìœ¨í™”** | ì»¤ë„¥ì…˜, ìºì‹œ, ìŠ¤ë ˆë“œ ë“± ì‹œìŠ¤í…œ ìžì› ëˆ„ìˆ˜ ë°©ì§€ |
| **5. Spring ìž‘ë™ ì›ë¦¬ ì´í•´** | IoC, DI, AOP ë“± ë‚´ë¶€ ë©”ì»¤ë‹ˆì¦˜ì˜ ê¸°ì´ˆ ê°œë…ì´ Bean ìƒëª…ì£¼ê¸° ìœ„ì— ì¡´ìž¬í•¨ |

---

# Spring Bean Scope

---

## ê°œë…

**Bean Scope**ëž€

> Spring IoC ì»¨í…Œì´ë„ˆì—ì„œ í•˜ë‚˜ì˜ Bean ì •ì˜(í´ëž˜ìŠ¤) ê°€
> 
> 
> **ì–¼ë§ˆë‚˜ ì˜¤ëž˜, ì–´ë–¤ ë²”ìœ„ì—ì„œ** ìœ ì§€ë ì§€ë¥¼ ê²°ì •í•˜ëŠ” ì„¤ì •ì´ì—ìš”.
> 
- Beanì´ **í•œ ë²ˆë§Œ ìƒì„±ë˜ì–´ ì „ì²´ì—ì„œ ê³µìœ ë ì§€**,
- ì•„ë‹ˆë©´ **ìš”ì²­ë§ˆë‹¤, ì„¸ì…˜ë§ˆë‹¤ ìƒˆë¡œ ë§Œë“¤ì–´ì§ˆì§€** ë¥¼ ì •í•˜ëŠ” ê±°ì˜ˆìš”.

---

## 2ï¸âƒ£ ì£¼ìš” Scope ì¢…ë¥˜ (6ê°€ì§€)

| Scope ì´ë¦„ | ìƒì„± ì‹œì  | ì†Œë©¸ ì‹œì  | ì‚¬ìš© ìœ„ì¹˜ | ì„¤ëª… |
| --- | --- | --- | --- | --- |
| **singleton**  | ì»¨í…Œì´ë„ˆ ì‹œìž‘ ì‹œ 1íšŒ ìƒì„± | ì»¨í…Œì´ë„ˆ ì¢…ë£Œ ì‹œ | ê¸°ë³¸ (ì „ì—­) | **ê¸°ë³¸ê°’**. í•˜ë‚˜ì˜ Bean ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì „ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê³µìœ  |
| **prototype**  | Bean ìš”ì²­ ì‹œë§ˆë‹¤ | ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì‹œ (Springì´ ê´€ë¦¬ ì•ˆí•¨) | ëª¨ë“  ê³„ì¸µ | ë§¤ë²ˆ ìƒˆë¡œìš´ Bean ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„± |
| **request**  | HTTP ìš”ì²­ ì‹œìž‘ ì‹œ | ìš”ì²­ ì¢…ë£Œ ì‹œ | Web Layer (Controller ë“±) | HTTP ìš”ì²­ë‹¹ Bean 1ê°œ ìƒì„± |
| **session**  | HTTP ì„¸ì…˜ ì‹œìž‘ ì‹œ | ì„¸ì…˜ ë§Œë£Œ ì‹œ | Web Layer | ì„¸ì…˜ë‹¹ Bean 1ê°œ ìƒì„± |
| **application**  | ServletContext ì‹œìž‘ ì‹œ | ServletContext ì¢…ë£Œ ì‹œ | Web Layer | ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ 1ê°œ (ì›¹ ì»¨í…ìŠ¤íŠ¸ ê¸°ì¤€) |
| **websocket**  | WebSocket ì—°ê²° ì‹œìž‘ ì‹œ | ì—°ê²° ì¢…ë£Œ ì‹œ | WebSocket í™˜ê²½ | WebSocket ì—°ê²°ë§ˆë‹¤ Bean 1ê°œ ìƒì„± |

---

## 3ï¸âƒ£ ê°€ìž¥ ë§Žì´ ì“°ì´ëŠ” ë‘ ê°€ì§€: Singleton vs Prototype

### **Singleton**

- **í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëª¨ë“  ìš”ì²­ì—ì„œ ê³µìœ .**
- ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™ ì‹œ Beanì´ í•œ ë²ˆë§Œ ìƒì„±ë¨.
- ë©”ëª¨ë¦¬ ì ˆì•½, ì„±ëŠ¥ íš¨ìœ¨ì .
- ë‹¨, **ìƒíƒœë¥¼ ê°€ì§€ë©´(Thread-Safeí•˜ì§€ ì•Šìœ¼ë©´)** ìœ„í—˜.

```java
@Component
@Scope("singleton") // ìƒëžµ ê°€ëŠ¥ (ê¸°ë³¸ê°’)
public class SingletonBean {
    ...
}

```

**íŠ¹ì§•**

- ë™ì¼í•œ Beanì„ ì—¬ëŸ¬ ê³³ì—ì„œ ì£¼ìž…í•´ë„ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤.
- ê³µìœ  ìžì›(Repository, Service)ì— ì í•©.

---

### **Prototype**

- **ìš”ì²­í•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ Bean ìƒì„±.**
- ê° ì‚¬ìš©ìžê°€ ë…ë¦½ëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©.
- Springì´ â€œìƒì„±â€ê¹Œì§€ë§Œ ê´€ë¦¬í•˜ê³  â€œì†Œë©¸â€ì€ ì§ì ‘ ì±…ìž„ì ¸ì•¼ í•¨.

```java
@Component
@Scope("prototype")
public class PrototypeBean {
    ...
}

```

**íŠ¹ì§•**

- ë§¤ë²ˆ ìƒˆë¡œ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ê°ì²´ì— ì í•© (ex. ìž„ì‹œ ìž‘ì—… ê°ì²´)
- Singletonê³¼ í•¨ê»˜ ì“°ë©´ ì£¼ì˜ í•„ìš” (Prototypeì€ ì£¼ìž… ì‹œ 1íšŒë§Œ ìƒì„±ë¨)

---

## 4ï¸âƒ£ Web ê´€ë ¨ Scope (request, session, application)

ì´ Scopeë“¤ì€ **Spring MVC** ê°™ì€ **ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸**ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•´ìš”.

ì¼ë°˜ Java ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

| Scope | ë™ìž‘ ì˜ˆì‹œ |
| --- | --- |
| **request** | ì‚¬ìš©ìžê°€ A íŽ˜ì´ì§€ ìš”ì²­ â†’ ìƒˆë¡œìš´ Bean ìƒì„± â†’ ì‘ë‹µ í›„ ì†Œë©¸ |
| **session** | ë¡œê·¸ì¸í•œ ì‚¬ìš©ìžë§ˆë‹¤ ì„¸ì…˜ ìƒì„± â†’ ì„¸ì…˜ ìœ ì§€ ë™ì•ˆ Bean ìœ ì§€ |
| **application** | ì„œë²„ ë‚´ ì „ì—­ì ìœ¼ë¡œ 1ê°œ Bean (ëª¨ë“  ì„¸ì…˜/ìš”ì²­ ê³µìœ ) |

---

## 5ï¸âƒ£ ì£¼ì˜í•  ì 

| ìƒí™© | ë¬¸ì œ | í•´ê²° ë°©ë²• |
| --- | --- | --- |
| Singleton Beanì—ì„œ Prototype Bean ì£¼ìž… | Prototypeì´ 1íšŒë§Œ ìƒì„±ë¨ | `@Lookup` ë©”ì„œë“œ ë˜ëŠ” `ObjectProvider` ì‚¬ìš© |
| Stateful Beanì„ Singletonìœ¼ë¡œ ë“±ë¡ | ì—¬ëŸ¬ ìš”ì²­ì´ ë™ì‹œì— ê°™ì€ Bean ê³µìœ  â†’ ë°ì´í„° ê¼¬ìž„ | ë°˜ë“œì‹œ **stateless**í•˜ê²Œ ì„¤ê³„ |
| Web Scope Beanì„ Non-Web Beanì—ì„œ ì‚¬ìš© | Context ë¯¸ì¡´ìž¬ â†’ ì˜ˆì™¸ ë°œìƒ | `@RequestScope`, `@SessionScope`ëŠ” ì›¹ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© |

---

## 6ï¸âƒ£ ì–´ë…¸í…Œì´ì…˜ ì •ë¦¬

| ì–´ë…¸í…Œì´ì…˜ | ì—­í•  |
| --- | --- |
| `@Scope("singleton")` | í•˜ë‚˜ì˜ Beanë§Œ ìƒì„± (ê¸°ë³¸ê°’) |
| `@Scope("prototype")` | ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆ ê°ì²´ ìƒì„± |
| `@RequestScope` | ìš”ì²­ ë‹¨ìœ„ Bean |
| `@SessionScope` | ì„¸ì…˜ ë‹¨ìœ„ Bean |
| `@ApplicationScope` | ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ Bean |
| `@WebSocketScope` | WebSocket ì—°ê²° ë‹¨ìœ„ Bean (Spring 5.3+) |

---

## 7ï¸âƒ£ Bean Lifecycleê³¼ Scopeì˜ ê´€ê³„

| Scope | ìƒì„±/ì†Œë©¸ ê´€ë¦¬ ì£¼ì²´ | Lifecycle íŠ¹ì§• |
| --- | --- | --- |
| Singleton | Springì´ ì „ ê³¼ì • ê´€ë¦¬ | ìƒì„±~ì†Œë©¸ê¹Œì§€ ê´€ë¦¬ë¨ |
| Prototype | ê°œë°œìžê°€ ì§ì ‘ ê´€ë¦¬ | ìƒì„±ë§Œ Springì´ ë‹´ë‹¹ |
| Web Scope | Spring Web Context | ìš”ì²­, ì„¸ì…˜, ì•± ë“± ì»¨í…ìŠ¤íŠ¸ ë‹¨ìœ„ë¡œ ê´€ë¦¬ |

> Lifecycleì€ â€œì–´ë–¤ ê³¼ì •ì„ ê±°ì¹˜ë‚˜â€
> 
> 
> **Scope**ëŠ” â€œê·¸ ê³¼ì •ì´ ì–¼ë§ˆ ë™ì•ˆ ì§€ì†ë˜ë‚˜â€
> 
> ë¥¼ ì •ì˜í•œë‹¤ê³  ë³´ë©´ ë©ë‹ˆë‹¤.
> 

---
